<!doctype html>

<html>
    <head>
        <meta charset="utf-8" />

        <title>Random Dungeon Generators</title>

        <script src="dat.gui.min.js"></script>
        <script src="helpers.js"></script>
        <script src="algos/SimpleRoomMaze.js"></script>
        <script src="algos/simple.js"></script>

        <script>
            var options = {
                    size: { x: 128, y: 128 },
                    minRoomSize: { x: 4, y: 4 },
                    maxRoomSize: { x: 16, y: 16 },
                    maxRooms: 32,
                    algorithm: 'SimpleRoomMaze',
                    regenerate: function() {
                        var canvas = document.getElementById('view'),
                            ctx = canvas.getContext('2d'),
                            timeStart = Date.now(),
                            grid = window[options.algorithm].generate(options.size, options.minRoomSize, options.maxRoomSize, options.maxRooms),
                            timeEnd = Date.now();

                        console.log('Generation took:', (timeEnd - timeStart) + 'ms');

                        canvas.width = 512;
                        canvas.height = 512;

                        var xlen = grid.length,
                            ylen = grid[0].length,
                            xscale = canvas.width / options.size.x,
                            yscale = canvas.height / options.size.y;

                        //draw
                        for(var x = 0; x < xlen; ++x) {
                            for(var y = 0; y < ylen; ++y) {
                                var tile = grid[x][y];

                                if (tile === helpers.TILE_TYPE.EMPTY) ctx.fillStyle = '#351330';
                                else if (tile === helpers.TILE_TYPE.FLOOR) ctx.fillStyle = '#64908A';
                                else if (tile === helpers.TILE_TYPE.WALL) ctx.fillStyle = '#424254';

                                ctx.fillRect(x * xscale, y * yscale, xscale, yscale);
                            }
                        }
                    }
                },
                gui = null;

            function init() {
                gui = new dat.GUI();
                initGui();
                options.regenerate();
            }

            function initGui() {
                var fsz = gui.addFolder('Size');
                fsz.add(options.size, 'x', 16, 512).step(1);
                fsz.add(options.size, 'y', 16, 512).step(1);

                var frsz = gui.addFolder('Min Room Size');
                frsz.add(options.minRoomSize, 'x', 3, 64).step(1);
                frsz.add(options.minRoomSize, 'y', 3, 64).step(1);

                var fmrsz = gui.addFolder('Max Room Size');
                fmrsz.add(options.maxRoomSize, 'x', 4, 64).step(1);
                fmrsz.add(options.maxRoomSize, 'y', 4, 64).step(1);

                gui.add(options, 'maxRooms', 0, 256).step(1);
                gui.add(options, 'algorithm', {
                    'Room Maze': 'SimpleRoomMaze',
                    'Simple': 'Simple'
                });
                gui.add(options, 'regenerate');
            }
        </script>
    </head>

    <body onload="init();">
        <!-- Main Content -->
        <section>
            <canvas id="view"></canvas>
        </section>
    </body>
</html>